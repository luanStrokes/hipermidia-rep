!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):"object"==typeof exports?module.exports=i(require("jquery")):t.lightbox=i(t.jQuery)}(this,function(g){function t(t){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=g.extend({},this.constructor.defaults),this.option(t)}return t.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:600,fitImagesInViewport:!0,imageFadeDuration:600,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1},t.prototype.option=function(t){g.extend(this.options,t)},t.prototype.imageCountLabel=function(t,i){return this.options.albumLabel.replace(/%1/g,t).replace(/%2/g,i)},t.prototype.init=function(){var t=this;g(document).ready(function(){t.enable(),t.build()})},t.prototype.enable=function(){var i=this;g("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(t){return i.start(g(t.currentTarget)),!1})},t.prototype.build=function(){var i=this;g('<div id="lightboxOverlay" class="lightboxOverlay"></div><div id="lightbox" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" /><div class="lb-nav"><a class="lb-prev" href="" ></a><a class="lb-next" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(g("body")),this.$lightbox=g("#lightbox"),this.$overlay=g("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.$image=this.$lightbox.find(".lb-image"),this.$nav=this.$lightbox.find(".lb-nav"),this.containerPadding={top:parseInt(this.$container.css("padding-top"),10),right:parseInt(this.$container.css("padding-right"),10),bottom:parseInt(this.$container.css("padding-bottom"),10),left:parseInt(this.$container.css("padding-left"),10)},this.imageBorderWidth={top:parseInt(this.$image.css("border-top-width"),10),right:parseInt(this.$image.css("border-right-width"),10),bottom:parseInt(this.$image.css("border-bottom-width"),10),left:parseInt(this.$image.css("border-left-width"),10)},this.$overlay.hide().on("click",function(){return i.end(),!1}),this.$lightbox.hide().on("click",function(t){return"lightbox"===g(t.target).attr("id")&&i.end(),!1}),this.$outerContainer.on("click",function(t){return"lightbox"===g(t.target).attr("id")&&i.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===i.currentImageIndex?i.changeImage(i.album.length-1):i.changeImage(i.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return i.currentImageIndex===i.album.length-1?i.changeImage(0):i.changeImage(i.currentImageIndex+1),!1}),this.$nav.on("mousedown",function(t){3===t.which&&(i.$nav.css("pointer-events","none"),i.$lightbox.one("contextmenu",function(){setTimeout(function(){this.$nav.css("pointer-events","auto")}.bind(i),0)}))}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return i.end(),!1})},t.prototype.start=function(t){var i=this,e=g(window);e.on("resize",g.proxy(this.sizeOverlay,this)),g("select, object, embed").css({visibility:"hidden"}),this.sizeOverlay(),this.album=[];var n=0;function o(t){i.album.push({link:t.attr("href"),title:t.attr("data-title")||t.attr("title")})}var a,s=t.attr("data-lightbox");if(s){a=g(t.prop("tagName")+'[data-lightbox="'+s+'"]');for(var r=0;r<a.length;r=++r)o(g(a[r])),a[r]===t[0]&&(n=r)}else if("lightbox"===t.attr("rel"))o(t);else{a=g(t.prop("tagName")+'[rel="'+t.attr("rel")+'"]');for(var h=0;h<a.length;h=++h)o(g(a[h])),a[h]===t[0]&&(n=h)}var l=e.scrollTop()+this.options.positionFromTop,d=e.scrollLeft();this.$lightbox.css({top:l+"px",left:d+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&g("body").addClass("lb-disable-scrolling"),this.changeImage(n)},t.prototype.changeImage=function(s){var r=this;this.disableKeyboardNav();var h=this.$lightbox.find(".lb-image");this.$overlay.fadeIn(this.options.fadeDuration),g(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating");var l=new Image;l.onload=function(){var t,i,e,n,o,a;h.attr("src",r.album[s].link),g(l),h.width(l.width),h.height(l.height),r.options.fitImagesInViewport&&(a=g(window).width(),o=g(window).height(),n=a-r.containerPadding.left-r.containerPadding.right-r.imageBorderWidth.left-r.imageBorderWidth.right-20,e=o-r.containerPadding.top-r.containerPadding.bottom-r.imageBorderWidth.top-r.imageBorderWidth.bottom-120,r.options.maxWidth&&r.options.maxWidth<n&&(n=r.options.maxWidth),r.options.maxHeight&&r.options.maxHeight<n&&(e=r.options.maxHeight),(l.width>n||l.height>e)&&(l.width/n>l.height/e?(i=n,t=parseInt(l.height/(l.width/i),10)):(t=e,i=parseInt(l.width/(l.height/t),10)),h.width(i),h.height(t))),r.sizeContainer(h.width(),h.height())},l.src=this.album[s].link,this.currentImageIndex=s},t.prototype.sizeOverlay=function(){this.$overlay.width(g(document).width()).height(g(document).height())},t.prototype.sizeContainer=function(t,i){var e=this,n=this.$outerContainer.outerWidth(),o=this.$outerContainer.outerHeight(),a=t+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,s=i+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;function r(){e.$lightbox.find(".lb-dataContainer").width(a),e.$lightbox.find(".lb-prevLink").height(s),e.$lightbox.find(".lb-nextLink").height(s),e.showImage()}n!==a||o!==s?this.$outerContainer.animate({width:a,height:s},this.options.resizeDuration,"swing",function(){r()}):r()},t.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},t.prototype.updateNav=function(){var t=!1;try{document.createEvent("TouchEvent"),t=!!this.options.alwaysShowNavOnTouchDevices}catch(t){}this.$lightbox.find(".lb-nav").show(),1<this.album.length&&(this.options.wrapAround?(t&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(0<this.currentImageIndex&&(this.$lightbox.find(".lb-prev").show(),t&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),t&&this.$lightbox.find(".lb-next").css("opacity","1"))))},t.prototype.updateDetails=function(){var t=this;if(void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title){var i=this.$lightbox.find(".lb-caption");this.options.sanitizeTitle?i.text(this.album[this.currentImageIndex].title):i.html(this.album[this.currentImageIndex].title),i.fadeIn("fast").find("a").on("click",function(t){void 0!==g(this).attr("target")?window.open(g(this).attr("href"),g(this).attr("target")):location.href=g(this).attr("href")})}if(1<this.album.length&&this.options.showImageNumberLabel){var e=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(e).fadeIn("fast")}else this.$lightbox.find(".lb-number").hide();this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return t.sizeOverlay()})},t.prototype.preloadNeighboringImages=function(){this.album.length>this.currentImageIndex+1&&((new Image).src=this.album[this.currentImageIndex+1].link);0<this.currentImageIndex&&((new Image).src=this.album[this.currentImageIndex-1].link)},t.prototype.enableKeyboardNav=function(){g(document).on("keyup.keyboard",g.proxy(this.keyboardAction,this))},t.prototype.disableKeyboardNav=function(){g(document).off(".keyboard")},t.prototype.keyboardAction=function(t){var i=t.keyCode,e=String.fromCharCode(i).toLowerCase();27===i||e.match(/x|o|c/)?this.end():"p"===e||37===i?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&1<this.album.length&&this.changeImage(this.album.length-1):"n"!==e&&39!==i||(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&1<this.album.length&&this.changeImage(0))},t.prototype.end=function(){this.disableKeyboardNav(),g(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),g("select, object, embed").css({visibility:"visible"}),this.options.disableScrolling&&g("body").removeClass("lb-disable-scrolling")},new t});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpZ2h0Ym94LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJsaWdodGJveCIsImpRdWVyeSIsInRoaXMiLCIkIiwiTGlnaHRib3giLCJvcHRpb25zIiwiYWxidW0iLCJjdXJyZW50SW1hZ2VJbmRleCIsImluaXQiLCJleHRlbmQiLCJjb25zdHJ1Y3RvciIsImRlZmF1bHRzIiwib3B0aW9uIiwiYWxidW1MYWJlbCIsImFsd2F5c1Nob3dOYXZPblRvdWNoRGV2aWNlcyIsImZhZGVEdXJhdGlvbiIsImZpdEltYWdlc0luVmlld3BvcnQiLCJpbWFnZUZhZGVEdXJhdGlvbiIsInBvc2l0aW9uRnJvbVRvcCIsInJlc2l6ZUR1cmF0aW9uIiwic2hvd0ltYWdlTnVtYmVyTGFiZWwiLCJ3cmFwQXJvdW5kIiwiZGlzYWJsZVNjcm9sbGluZyIsInNhbml0aXplVGl0bGUiLCJwcm90b3R5cGUiLCJpbWFnZUNvdW50TGFiZWwiLCJjdXJyZW50SW1hZ2VOdW0iLCJ0b3RhbEltYWdlcyIsInJlcGxhY2UiLCJzZWxmIiwiZG9jdW1lbnQiLCJyZWFkeSIsImVuYWJsZSIsImJ1aWxkIiwib24iLCJldmVudCIsInN0YXJ0IiwiY3VycmVudFRhcmdldCIsImFwcGVuZFRvIiwiJGxpZ2h0Ym94IiwiJG92ZXJsYXkiLCIkb3V0ZXJDb250YWluZXIiLCJmaW5kIiwiJGNvbnRhaW5lciIsIiRpbWFnZSIsIiRuYXYiLCJjb250YWluZXJQYWRkaW5nIiwidG9wIiwicGFyc2VJbnQiLCJjc3MiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJpbWFnZUJvcmRlcldpZHRoIiwiaGlkZSIsImVuZCIsInRhcmdldCIsImF0dHIiLCJjaGFuZ2VJbWFnZSIsImxlbmd0aCIsIndoaWNoIiwib25lIiwic2V0VGltZW91dCIsImJpbmQiLCIkbGluayIsIiR3aW5kb3ciLCJ3aW5kb3ciLCJwcm94eSIsInNpemVPdmVybGF5IiwidmlzaWJpbGl0eSIsImltYWdlTnVtYmVyIiwiYWRkVG9BbGJ1bSIsInB1c2giLCJsaW5rIiwidGl0bGUiLCIkbGlua3MiLCJkYXRhTGlnaHRib3hWYWx1ZSIsInByb3AiLCJpIiwiaiIsInNjcm9sbFRvcCIsInNjcm9sbExlZnQiLCJmYWRlSW4iLCJhZGRDbGFzcyIsImRpc2FibGVLZXlib2FyZE5hdiIsInByZWxvYWRlciIsIkltYWdlIiwib25sb2FkIiwiaW1hZ2VIZWlnaHQiLCJpbWFnZVdpZHRoIiwibWF4SW1hZ2VIZWlnaHQiLCJtYXhJbWFnZVdpZHRoIiwid2luZG93SGVpZ2h0Iiwid2luZG93V2lkdGgiLCJ3aWR0aCIsImhlaWdodCIsIm1heFdpZHRoIiwibWF4SGVpZ2h0Iiwic2l6ZUNvbnRhaW5lciIsInNyYyIsIm9sZFdpZHRoIiwib3V0ZXJXaWR0aCIsIm9sZEhlaWdodCIsIm91dGVySGVpZ2h0IiwibmV3V2lkdGgiLCJuZXdIZWlnaHQiLCJwb3N0UmVzaXplIiwic2hvd0ltYWdlIiwiYW5pbWF0ZSIsInN0b3AiLCJ1cGRhdGVOYXYiLCJ1cGRhdGVEZXRhaWxzIiwicHJlbG9hZE5laWdoYm9yaW5nSW1hZ2VzIiwiZW5hYmxlS2V5Ym9hcmROYXYiLCJhbHdheXNTaG93TmF2IiwiY3JlYXRlRXZlbnQiLCJlIiwic2hvdyIsIiRjYXB0aW9uIiwidGV4dCIsImh0bWwiLCJ1bmRlZmluZWQiLCJvcGVuIiwibG9jYXRpb24iLCJocmVmIiwibGFiZWxUZXh0IiwicmVtb3ZlQ2xhc3MiLCJrZXlib2FyZEFjdGlvbiIsIm9mZiIsImtleWNvZGUiLCJrZXlDb2RlIiwia2V5IiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwidG9Mb3dlckNhc2UiLCJtYXRjaCIsImZhZGVPdXQiXSwibWFwcGluZ3MiOiJDQWFDLFNBQVVBLEVBQU1DLEdBQ1MsbUJBQVhDLFFBQXlCQSxPQUFPQyxJQUV2Q0QsT0FBTyxDQUFDLFVBQVdELEdBQ08saUJBQVpHLFFBSWRDLE9BQU9ELFFBQVVILEVBQVFLLFFBQVEs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QUt3RCxZQUFZeEQsS0FBS0ssa0JBQW9CLEdBQ2pDTCxLQUFLRyxRQUFRZ0IsWUFBa0MsRUFBcEJuQixLQUFLSSxNQUFNcUQsUUFDL0N6RCxLQUFLd0QsWUFBWXhELEtBQUtJLE1BQU1xRCxPQUFTLEdBRXRCLE1BQVJ3RSxHQVpjLEtBWUNGLElBQ3BCL0gsS0FBS0ssb0JBQXNCTCxLQUFLSSxNQUFNcUQsT0FBUyxFQUNqRHpELEtBQUt3RCxZQUFZeEQsS0FBS0ssa0JBQW9CLEdBQ2pDTCxLQUFLRyxRQUFRZ0IsWUFBa0MsRUFBcEJuQixLQUFLSSxNQUFNcUQsUUFDL0N6RCxLQUFLd0QsWUFBWSxLQU12QnRELEVBQVNvQixVQUFVK0IsSUFBTSxXQUN2QnJELEtBQUtrRixxQkFDTGpGLEVBQUUrRCxRQUFROEQsSUFBSSxTQUFVOUgsS0FBS2tFLGFBQzdCbEUsS0FBS3FDLFVBQVVpRyxRQUFRdEksS0FBS0csUUFBUVUsY0FDcENiLEtBQUtzQyxTQUFTZ0csUUFBUXRJLEtBQUtHLFFBQVFVLGNBQ25DWixFQUFFLHlCQUF5QjhDLElBQUksQ0FDN0JvQixXQUFZLFlBRVZuRSxLQUFLRyxRQUFRaUIsa0JBQ2ZuQixFQUFFLFFBQVEySCxZQUFZLHlCQUluQixJQUFJMUgiLCJmaWxlIjoibGlnaHRib3guanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIExpZ2h0Ym94IHYyLjkuMFxuICogYnkgTG9rZXNoIERoYWthclxuICpcbiAqIE1vcmUgaW5mbzpcbiAqIGh0dHA6Ly9sb2tlc2hkaGFrYXIuY29tL3Byb2plY3RzL2xpZ2h0Ym94Mi9cbiAqXG4gKiBDb3B5cmlnaHQgMjAwNywgMjAxNSBMb2tlc2ggRGhha2FyXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9sb2tlc2gvbGlnaHRib3gyL2Jsb2IvbWFzdGVyL0xJQ0VOU0VcbiAqL1xuXG4vLyBVc2VzIE5vZGUsIEFNRCBvciBicm93c2VyIGdsb2JhbHMgdG8gY3JlYXRlIGEgbW9kdWxlLlxuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG4gICAgICAgIGRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAgICAgLy8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXG4gICAgICAgIC8vIGxpa2UgTm9kZS5cbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KVxuICAgICAgICByb290LmxpZ2h0Ym94ID0gZmFjdG9yeShyb290LmpRdWVyeSk7XG4gICAgfVxufSh0aGlzLCBmdW5jdGlvbiAoJCkge1xuXG4gIGZ1bmN0aW9uIExpZ2h0Ym94KG9wdGlvbnMpIHtcbiAgICB0aGlzLmFsYnVtID0gW107XG4gICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IHZvaWQgMDtcbiAgICB0aGlzLmluaXQoKTtcblxuICAgIC8vIG9wdGlvbnNcbiAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5jb25zdHJ1Y3Rvci5kZWZhdWx0cyk7XG4gICAgdGhpcy5vcHRpb24ob3B0aW9ucyk7XG4gIH1cblxuICAvLyBEZXNjcmlwdGlvbnMgb2YgYWxsIG9wdGlvbnMgYXZhaWxhYmxlIG9uIHRoZSBkZW1vIHNpdGU6XG4gIC8vIGh0dHA6Ly9sb2tlc2hkaGFrYXIuY29tL3Byb2plY3RzL2xpZ2h0Ym94Mi9pbmRleC5odG1sI29wdGlvbnNcbiAgTGlnaHRib3guZGVmYXVsdHMgPSB7XG4gICAgYWxidW1MYWJlbDogJ0ltYWdlICUxIG9mICUyJyxcbiAgICBhbHdheXNTaG93TmF2T25Ub3VjaERldmljZXM6IGZhbHNlLFxuICAgIGZhZGVEdXJhdGlvbjogNjAwLFxuICAgIGZpdEltYWdlc0luVmlld3BvcnQ6IHRydWUsXG4gICAgaW1hZ2VGYWRlRHVyYXRpb246IDYwMCxcbiAgICAvLyBtYXhXaWR0aDogODAwLFxuICAgIC8vIG1heEhlaWdodDogNjAwLFxuICAgIHBvc2l0aW9uRnJvbVRvcDogNTAsXG4gICAgcmVzaXplRHVyYXRpb246IDcwMCxcbiAgICBzaG93SW1hZ2VOdW1iZXJMYWJlbDogdHJ1ZSxcbiAgICB3cmFwQXJvdW5kOiBmYWxzZSxcbiAgICBkaXNhYmxlU2Nyb2xsaW5nOiBmYWxzZSxcbiAgICAvKlxuICAgIFNhbml0aXplIFRpdGxlXG4gICAgSWYgdGhlIGNhcHRpb24gZGF0YSBpcyB0cnVzdGVkLCBmb3IgZXhhbXBsZSB5b3UgYXJlIGhhcmRjb2RpbmcgaXQgaW4sIHRoZW4gbGVhdmUgdGhpcyB0byBmYWxzZS5cbiAgICBUaGlzIHdpbGwgZnJlZSB5b3UgdG8gYWRkIGh0bWwgdGFncywgc3VjaCBhcyBsaW5rcywgaW4gdGhlIGNhcHRpb24uXG5cbiAgICBJZiB0aGUgY2FwdGlvbiBkYXRhIGlzIHVzZXIgc3VibWl0dGVkIG9yIGZyb20gc29tZSBvdGhlciB1bnRydXN0ZWQgc291cmNlLCB0aGVuIHNldCB0aGlzIHRvIHRydWVcbiAgICB0byBwcmV2ZW50IHhzcyBhbmQgb3RoZXIgaW5qZWN0aW9uIGF0dGFja3MuXG4gICAgICovXG4gICAgc2FuaXRpemVUaXRsZTogZmFsc2VcbiAgfTtcblxuICBMaWdodGJveC5wcm90b3R5cGUub3B0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICQuZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmltYWdlQ291bnRMYWJlbCA9IGZ1bmN0aW9uKGN1cnJlbnRJbWFnZU51bSwgdG90YWxJbWFnZXMpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zLmFsYnVtTGFiZWwucmVwbGFjZSgvJTEvZywgY3VycmVudEltYWdlTnVtKS5yZXBsYWNlKC8lMi9nLCB0b3RhbEltYWdlcyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgLy8gQm90aCBlbmFibGUgYW5kIGJ1aWxkIG1ldGhvZHMgcmVxdWlyZSB0aGUgYm9keSB0YWcgdG8gYmUgaW4gdGhlIERPTS5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuZW5hYmxlKCk7XG4gICAgICBzZWxmLmJ1aWxkKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gTG9vcCB0aHJvdWdoIGFuY2hvcnMgYW5kIGFyZWFtYXBzIGxvb2tpbmcgZm9yIGVpdGhlciBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZXMgb3IgcmVsIGF0dHJpYnV0ZXNcbiAgLy8gdGhhdCBjb250YWluICdsaWdodGJveCcuIFdoZW4gdGhlc2UgYXJlIGNsaWNrZWQsIHN0YXJ0IGxpZ2h0Ym94LlxuICBMaWdodGJveC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICQoJ2JvZHknKS5vbignY2xpY2snLCAnYVtyZWxePWxpZ2h0Ym94XSwgYXJlYVtyZWxePWxpZ2h0Ym94XSwgYVtkYXRhLWxpZ2h0Ym94XSwgYXJlYVtkYXRhLWxpZ2h0Ym94XScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBzZWxmLnN0YXJ0KCQoZXZlbnQuY3VycmVudFRhcmdldCkpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIEJ1aWxkIGh0bWwgZm9yIHRoZSBsaWdodGJveCBhbmQgdGhlIG92ZXJsYXkuXG4gIC8vIEF0dGFjaCBldmVudCBoYW5kbGVycyB0byB0aGUgbmV3IERPTSBlbGVtZW50cy4gY2xpY2sgY2xpY2sgY2xpY2tcbiAgTGlnaHRib3gucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICQoJzxkaXYgaWQ9XCJsaWdodGJveE92ZXJsYXlcIiBjbGFzcz1cImxpZ2h0Ym94T3ZlcmxheVwiPjwvZGl2PjxkaXYgaWQ9XCJsaWdodGJveFwiIGNsYXNzPVwibGlnaHRib3hcIj48ZGl2IGNsYXNzPVwibGItb3V0ZXJDb250YWluZXJcIj48ZGl2IGNsYXNzPVwibGItY29udGFpbmVyXCI+PGltZyBjbGFzcz1cImxiLWltYWdlXCIgc3JjPVwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBUC8vL3dBQUFDSDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUNSQUVBT3c9PVwiIC8+PGRpdiBjbGFzcz1cImxiLW5hdlwiPjxhIGNsYXNzPVwibGItcHJldlwiIGhyZWY9XCJcIiA+PC9hPjxhIGNsYXNzPVwibGItbmV4dFwiIGhyZWY9XCJcIiA+PC9hPjwvZGl2PjxkaXYgY2xhc3M9XCJsYi1sb2FkZXJcIj48YSBjbGFzcz1cImxiLWNhbmNlbFwiPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPVwibGItZGF0YUNvbnRhaW5lclwiPjxkaXYgY2xhc3M9XCJsYi1kYXRhXCI+PGRpdiBjbGFzcz1cImxiLWRldGFpbHNcIj48c3BhbiBjbGFzcz1cImxiLWNhcHRpb25cIj48L3NwYW4+PHNwYW4gY2xhc3M9XCJsYi1udW1iZXJcIj48L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1cImxiLWNsb3NlQ29udGFpbmVyXCI+PGEgY2xhc3M9XCJsYi1jbG9zZVwiPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48L2Rpdj4nKS5hcHBlbmRUbygkKCdib2R5JykpO1xuXG4gICAgLy8gQ2FjaGUgalF1ZXJ5IG9iamVjdHNcbiAgICB0aGlzLiRsaWdodGJveCAgICAgICA9ICQoJyNsaWdodGJveCcpO1xuICAgIHRoaXMuJG92ZXJsYXkgICAgICAgID0gJCgnI2xpZ2h0Ym94T3ZlcmxheScpO1xuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW91dGVyQ29udGFpbmVyJyk7XG4gICAgdGhpcy4kY29udGFpbmVyICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY29udGFpbmVyJyk7XG4gICAgdGhpcy4kaW1hZ2UgICAgICAgICAgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UnKTtcbiAgICB0aGlzLiRuYXYgICAgICAgICAgICA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uYXYnKTtcblxuICAgIC8vIFN0b3JlIGNzcyB2YWx1ZXMgZm9yIGZ1dHVyZSBsb29rdXBcbiAgICB0aGlzLmNvbnRhaW5lclBhZGRpbmcgPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSxcbiAgICAgIHJpZ2h0OiBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JyksIDEwKSxcbiAgICAgIGJvdHRvbTogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1ib3R0b20nKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1sZWZ0JyksIDEwKVxuICAgIH07XG5cbiAgICB0aGlzLmltYWdlQm9yZGVyV2lkdGggPSB7XG4gICAgICB0b3A6IHBhcnNlSW50KHRoaXMuJGltYWdlLmNzcygnYm9yZGVyLXRvcC13aWR0aCcpLCAxMCksXG4gICAgICByaWdodDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItcmlnaHQtd2lkdGgnKSwgMTApLFxuICAgICAgYm90dG9tOiBwYXJzZUludCh0aGlzLiRpbWFnZS5jc3MoJ2JvcmRlci1ib3R0b20td2lkdGgnKSwgMTApLFxuICAgICAgbGVmdDogcGFyc2VJbnQodGhpcy4kaW1hZ2UuY3NzKCdib3JkZXItbGVmdC13aWR0aCcpLCAxMClcbiAgICB9O1xuXG4gICAgLy8gQXR0YWNoIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBuZXdseSBtaW50ZWQgRE9NIGVsZW1lbnRzXG4gICAgdGhpcy4kb3ZlcmxheS5oaWRlKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kbGlnaHRib3guaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBpZiAoJChldmVudC50YXJnZXQpLmF0dHIoJ2lkJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gMCkge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuYWxidW0ubGVuZ3RoIC0gMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggLSAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gc2VsZi5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHNlbGYuY2hhbmdlSW1hZ2UoMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggKyAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8qXG4gICAgICBTaG93IGNvbnRleHQgbWVudSBmb3IgaW1hZ2Ugb24gcmlnaHQtY2xpY2tcblxuICAgICAgVGhlcmUgaXMgYSBkaXYgY29udGFpbmluZyB0aGUgbmF2aWdhdGlvbiB0aGF0IHNwYW5zIHRoZSBlbnRpcmUgaW1hZ2UgYW5kIGxpdmVzIGFib3ZlIG9mIGl0LiBJZlxuICAgICAgeW91IHJpZ2h0LWNsaWNrLCB5b3UgYXJlIHJpZ2h0IGNsaWNraW5nIHRoaXMgZGl2IGFuZCBub3QgdGhlIGltYWdlLiBUaGlzIHByZXZlbnRzIHVzZXJzIGZyb21cbiAgICAgIHNhdmluZyB0aGUgaW1hZ2Ugb3IgdXNpbmcgb3RoZXIgY29udGV4dCBtZW51IGFjdGlvbnMgd2l0aCB0aGUgaW1hZ2UuXG5cbiAgICAgIFRvIGZpeCB0aGlzLCB3aGVuIHdlIGRldGVjdCB0aGUgcmlnaHQgbW91c2UgYnV0dG9uIGlzIHByZXNzZWQgZG93biwgYnV0IG5vdCB5ZXQgY2xpY2tlZCwgd2VcbiAgICAgIHNldCBwb2ludGVyLWV2ZW50cyB0byBub25lIG9uIHRoZSBuYXYgZGl2LiBUaGlzIGlzIHNvIHRoYXQgdGhlIHVwY29taW5nIHJpZ2h0LWNsaWNrIGV2ZW50IG9uXG4gICAgICB0aGUgbmV4dCBtb3VzZXVwIHdpbGwgYnViYmxlIGRvd24gdG8gdGhlIGltYWdlLiBPbmNlIHRoZSByaWdodC1jbGljay9jb250ZXh0bWVudSBldmVudCBvY2N1cnNcbiAgICAgIHdlIHNldCB0aGUgcG9pbnRlciBldmVudHMgYmFjayB0byBhdXRvIGZvciB0aGUgbmF2IGRpdiBzbyBpdCBjYW4gY2FwdHVyZSBob3ZlciBhbmQgbGVmdC1jbGlja1xuICAgICAgZXZlbnRzIGFzIHVzdWFsLlxuICAgICAqL1xuICAgIHRoaXMuJG5hdi5vbignbW91c2Vkb3duJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC53aGljaCA9PT0gMykge1xuICAgICAgICBzZWxmLiRuYXYuY3NzKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7XG5cbiAgICAgICAgc2VsZi4kbGlnaHRib3gub25lKCdjb250ZXh0bWVudScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHRoaXMuJG5hdi5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ2F1dG8nKTtcbiAgICAgICAgICB9LmJpbmQoc2VsZiksIDApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlciwgLmxiLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICBzZWxmLmVuZCgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIFNob3cgb3ZlcmxheSBhbmQgbGlnaHRib3guIElmIHRoZSBpbWFnZSBpcyBwYXJ0IG9mIGEgc2V0LCBhZGQgc2libGluZ3MgdG8gYWxidW0gYXJyYXkuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCRsaW5rKSB7XG4gICAgdmFyIHNlbGYgICAgPSB0aGlzO1xuICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpO1xuXG4gICAgJHdpbmRvdy5vbigncmVzaXplJywgJC5wcm94eSh0aGlzLnNpemVPdmVybGF5LCB0aGlzKSk7XG5cbiAgICAkKCdzZWxlY3QsIG9iamVjdCwgZW1iZWQnKS5jc3Moe1xuICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbidcbiAgICB9KTtcblxuICAgIHRoaXMuc2l6ZU92ZXJsYXkoKTtcblxuICAgIHRoaXMuYWxidW0gPSBbXTtcbiAgICB2YXIgaW1hZ2VOdW1iZXIgPSAwO1xuXG4gICAgZnVuY3Rpb24gYWRkVG9BbGJ1bSgkbGluaykge1xuICAgICAgc2VsZi5hbGJ1bS5wdXNoKHtcbiAgICAgICAgbGluazogJGxpbmsuYXR0cignaHJlZicpLFxuICAgICAgICB0aXRsZTogJGxpbmsuYXR0cignZGF0YS10aXRsZScpIHx8ICRsaW5rLmF0dHIoJ3RpdGxlJylcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFN1cHBvcnQgYm90aCBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZSBhbmQgcmVsIGF0dHJpYnV0ZSBpbXBsZW1lbnRhdGlvbnNcbiAgICB2YXIgZGF0YUxpZ2h0Ym94VmFsdWUgPSAkbGluay5hdHRyKCdkYXRhLWxpZ2h0Ym94Jyk7XG4gICAgdmFyICRsaW5rcztcblxuICAgIGlmIChkYXRhTGlnaHRib3hWYWx1ZSkge1xuICAgICAgJGxpbmtzID0gJCgkbGluay5wcm9wKCd0YWdOYW1lJykgKyAnW2RhdGEtbGlnaHRib3g9XCInICsgZGF0YUxpZ2h0Ym94VmFsdWUgKyAnXCJdJyk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRsaW5rcy5sZW5ndGg7IGkgPSArK2kpIHtcbiAgICAgICAgYWRkVG9BbGJ1bSgkKCRsaW5rc1tpXSkpO1xuICAgICAgICBpZiAoJGxpbmtzW2ldID09PSAkbGlua1swXSkge1xuICAgICAgICAgIGltYWdlTnVtYmVyID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJGxpbmsuYXR0cigncmVsJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgLy8gSWYgaW1hZ2UgaXMgbm90IHBhcnQgb2YgYSBzZXRcbiAgICAgICAgYWRkVG9BbGJ1bSgkbGluayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBpbWFnZSBpcyBwYXJ0IG9mIGEgc2V0XG4gICAgICAgICRsaW5rcyA9ICQoJGxpbmsucHJvcCgndGFnTmFtZScpICsgJ1tyZWw9XCInICsgJGxpbmsuYXR0cigncmVsJykgKyAnXCJdJyk7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgJGxpbmtzLmxlbmd0aDsgaiA9ICsraikge1xuICAgICAgICAgIGFkZFRvQWxidW0oJCgkbGlua3Nbal0pKTtcbiAgICAgICAgICBpZiAoJGxpbmtzW2pdID09PSAkbGlua1swXSkge1xuICAgICAgICAgICAgaW1hZ2VOdW1iZXIgPSBqO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFBvc2l0aW9uIExpZ2h0Ym94XG4gICAgdmFyIHRvcCAgPSAkd2luZG93LnNjcm9sbFRvcCgpICsgdGhpcy5vcHRpb25zLnBvc2l0aW9uRnJvbVRvcDtcbiAgICB2YXIgbGVmdCA9ICR3aW5kb3cuc2Nyb2xsTGVmdCgpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmNzcyh7XG4gICAgICB0b3A6IHRvcCArICdweCcsXG4gICAgICBsZWZ0OiBsZWZ0ICsgJ3B4J1xuICAgIH0pLmZhZGVJbih0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcblxuICAgIC8vIERpc2FibGUgc2Nyb2xsaW5nIG9mIHRoZSBwYWdlIHdoaWxlIG9wZW5cbiAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVTY3JvbGxpbmcpIHtcbiAgICAgICQoJ2JvZHknKS5hZGRDbGFzcygnbGItZGlzYWJsZS1zY3JvbGxpbmcnKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZUltYWdlKGltYWdlTnVtYmVyKTtcbiAgfTtcblxuICAvLyBIaWRlIG1vc3QgVUkgZWxlbWVudHMgaW4gcHJlcGFyYXRpb24gZm9yIHRoZSBhbmltYXRlZCByZXNpemluZyBvZiB0aGUgbGlnaHRib3guXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5jaGFuZ2VJbWFnZSA9IGZ1bmN0aW9uKGltYWdlTnVtYmVyKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5kaXNhYmxlS2V5Ym9hcmROYXYoKTtcbiAgICB2YXIgJGltYWdlID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWltYWdlJyk7XG5cbiAgICB0aGlzLiRvdmVybGF5LmZhZGVJbih0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcblxuICAgICQoJy5sYi1sb2FkZXInKS5mYWRlSW4oJ3Nsb3cnKTtcbiAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UsIC5sYi1uYXYsIC5sYi1wcmV2LCAubGItbmV4dCwgLmxiLWRhdGFDb250YWluZXIsIC5sYi1udW1iZXJzLCAubGItY2FwdGlvbicpLmhpZGUoKTtcblxuICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFkZENsYXNzKCdhbmltYXRpbmcnKTtcblxuICAgIC8vIFdoZW4gaW1hZ2UgdG8gc2hvdyBpcyBwcmVsb2FkZWQsIHdlIHNlbmQgdGhlIHdpZHRoIGFuZCBoZWlnaHQgdG8gc2l6ZUNvbnRhaW5lcigpXG4gICAgdmFyIHByZWxvYWRlciA9IG5ldyBJbWFnZSgpO1xuICAgIHByZWxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciAkcHJlbG9hZGVyO1xuICAgICAgdmFyIGltYWdlSGVpZ2h0O1xuICAgICAgdmFyIGltYWdlV2lkdGg7XG4gICAgICB2YXIgbWF4SW1hZ2VIZWlnaHQ7XG4gICAgICB2YXIgbWF4SW1hZ2VXaWR0aDtcbiAgICAgIHZhciB3aW5kb3dIZWlnaHQ7XG4gICAgICB2YXIgd2luZG93V2lkdGg7XG5cbiAgICAgICRpbWFnZS5hdHRyKCdzcmMnLCBzZWxmLmFsYnVtW2ltYWdlTnVtYmVyXS5saW5rKTtcblxuICAgICAgJHByZWxvYWRlciA9ICQocHJlbG9hZGVyKTtcblxuICAgICAgJGltYWdlLndpZHRoKHByZWxvYWRlci53aWR0aCk7XG4gICAgICAkaW1hZ2UuaGVpZ2h0KHByZWxvYWRlci5oZWlnaHQpO1xuXG4gICAgICBpZiAoc2VsZi5vcHRpb25zLmZpdEltYWdlc0luVmlld3BvcnQpIHtcbiAgICAgICAgLy8gRml0IGltYWdlIGluc2lkZSB0aGUgdmlld3BvcnQuXG4gICAgICAgIC8vIFRha2UgaW50byBhY2NvdW50IHRoZSBib3JkZXIgYXJvdW5kIHRoZSBpbWFnZSBhbmQgYW4gYWRkaXRpb25hbCAxMHB4IGd1dHRlciBvbiBlYWNoIHNpZGUuXG5cbiAgICAgICAgd2luZG93V2lkdGggICAgPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICAgICAgd2luZG93SGVpZ2h0ICAgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG4gICAgICAgIG1heEltYWdlV2lkdGggID0gd2luZG93V2lkdGggLSBzZWxmLmNvbnRhaW5lclBhZGRpbmcubGVmdCAtIHNlbGYuY29udGFpbmVyUGFkZGluZy5yaWdodCAtIHNlbGYuaW1hZ2VCb3JkZXJXaWR0aC5sZWZ0IC0gc2VsZi5pbWFnZUJvcmRlcldpZHRoLnJpZ2h0IC0gMjA7XG4gICAgICAgIG1heEltYWdlSGVpZ2h0ID0gd2luZG93SGVpZ2h0IC0gc2VsZi5jb250YWluZXJQYWRkaW5nLnRvcCAtIHNlbGYuY29udGFpbmVyUGFkZGluZy5ib3R0b20gLSBzZWxmLmltYWdlQm9yZGVyV2lkdGgudG9wIC0gc2VsZi5pbWFnZUJvcmRlcldpZHRoLmJvdHRvbSAtIDEyMDtcblxuICAgICAgICAvLyBDaGVjayBpZiBpbWFnZSBzaXplIGlzIGxhcmdlciB0aGVuIG1heFdpZHRofG1heEhlaWdodCBpbiBzZXR0aW5nc1xuICAgICAgICBpZiAoc2VsZi5vcHRpb25zLm1heFdpZHRoICYmIHNlbGYub3B0aW9ucy5tYXhXaWR0aCA8IG1heEltYWdlV2lkdGgpIHtcbiAgICAgICAgICBtYXhJbWFnZVdpZHRoID0gc2VsZi5vcHRpb25zLm1heFdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxmLm9wdGlvbnMubWF4SGVpZ2h0ICYmIHNlbGYub3B0aW9ucy5tYXhIZWlnaHQgPCBtYXhJbWFnZVdpZHRoKSB7XG4gICAgICAgICAgbWF4SW1hZ2VIZWlnaHQgPSBzZWxmLm9wdGlvbnMubWF4SGVpZ2h0O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSXMgdGhlcmUgYSBmaXR0aW5nIGlzc3VlP1xuICAgICAgICBpZiAoKHByZWxvYWRlci53aWR0aCA+IG1heEltYWdlV2lkdGgpIHx8IChwcmVsb2FkZXIuaGVpZ2h0ID4gbWF4SW1hZ2VIZWlnaHQpKSB7XG4gICAgICAgICAgaWYgKChwcmVsb2FkZXIud2lkdGggLyBtYXhJbWFnZVdpZHRoKSA+IChwcmVsb2FkZXIuaGVpZ2h0IC8gbWF4SW1hZ2VIZWlnaHQpKSB7XG4gICAgICAgICAgICBpbWFnZVdpZHRoICA9IG1heEltYWdlV2lkdGg7XG4gICAgICAgICAgICBpbWFnZUhlaWdodCA9IHBhcnNlSW50KHByZWxvYWRlci5oZWlnaHQgLyAocHJlbG9hZGVyLndpZHRoIC8gaW1hZ2VXaWR0aCksIDEwKTtcbiAgICAgICAgICAgICRpbWFnZS53aWR0aChpbWFnZVdpZHRoKTtcbiAgICAgICAgICAgICRpbWFnZS5oZWlnaHQoaW1hZ2VIZWlnaHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbWFnZUhlaWdodCA9IG1heEltYWdlSGVpZ2h0O1xuICAgICAgICAgICAgaW1hZ2VXaWR0aCA9IHBhcnNlSW50KHByZWxvYWRlci53aWR0aCAvIChwcmVsb2FkZXIuaGVpZ2h0IC8gaW1hZ2VIZWlnaHQpLCAxMCk7XG4gICAgICAgICAgICAkaW1hZ2Uud2lkdGgoaW1hZ2VXaWR0aCk7XG4gICAgICAgICAgICAkaW1hZ2UuaGVpZ2h0KGltYWdlSGVpZ2h0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHNlbGYuc2l6ZUNvbnRhaW5lcigkaW1hZ2Uud2lkdGgoKSwgJGltYWdlLmhlaWdodCgpKTtcbiAgICB9O1xuXG4gICAgcHJlbG9hZGVyLnNyYyAgICAgICAgICA9IHRoaXMuYWxidW1baW1hZ2VOdW1iZXJdLmxpbms7XG4gICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IGltYWdlTnVtYmVyO1xuICB9O1xuXG4gIC8vIFN0cmV0Y2ggb3ZlcmxheSB0byBmaXQgdGhlIHZpZXdwb3J0XG4gIExpZ2h0Ym94LnByb3RvdHlwZS5zaXplT3ZlcmxheSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJG92ZXJsYXlcbiAgICAgIC53aWR0aCgkKGRvY3VtZW50KS53aWR0aCgpKVxuICAgICAgLmhlaWdodCgkKGRvY3VtZW50KS5oZWlnaHQoKSk7XG4gIH07XG5cbiAgLy8gQW5pbWF0ZSB0aGUgc2l6ZSBvZiB0aGUgbGlnaHRib3ggdG8gZml0IHRoZSBpbWFnZSB3ZSBhcmUgc2hvd2luZ1xuICBMaWdodGJveC5wcm90b3R5cGUuc2l6ZUNvbnRhaW5lciA9IGZ1bmN0aW9uKGltYWdlV2lkdGgsIGltYWdlSGVpZ2h0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIG9sZFdpZHRoICA9IHRoaXMuJG91dGVyQ29udGFpbmVyLm91dGVyV2lkdGgoKTtcbiAgICB2YXIgb2xkSGVpZ2h0ID0gdGhpcy4kb3V0ZXJDb250YWluZXIub3V0ZXJIZWlnaHQoKTtcbiAgICB2YXIgbmV3V2lkdGggID0gaW1hZ2VXaWR0aCArIHRoaXMuY29udGFpbmVyUGFkZGluZy5sZWZ0ICsgdGhpcy5jb250YWluZXJQYWRkaW5nLnJpZ2h0ICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLmxlZnQgKyB0aGlzLmltYWdlQm9yZGVyV2lkdGgucmlnaHQ7XG4gICAgdmFyIG5ld0hlaWdodCA9IGltYWdlSGVpZ2h0ICsgdGhpcy5jb250YWluZXJQYWRkaW5nLnRvcCArIHRoaXMuY29udGFpbmVyUGFkZGluZy5ib3R0b20gKyB0aGlzLmltYWdlQm9yZGVyV2lkdGgudG9wICsgdGhpcy5pbWFnZUJvcmRlcldpZHRoLmJvdHRvbTtcblxuICAgIGZ1bmN0aW9uIHBvc3RSZXNpemUoKSB7XG4gICAgICBzZWxmLiRsaWdodGJveC5maW5kKCcubGItZGF0YUNvbnRhaW5lcicpLndpZHRoKG5ld1dpZHRoKTtcbiAgICAgIHNlbGYuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2TGluaycpLmhlaWdodChuZXdIZWlnaHQpO1xuICAgICAgc2VsZi4kbGlnaHRib3guZmluZCgnLmxiLW5leHRMaW5rJykuaGVpZ2h0KG5ld0hlaWdodCk7XG4gICAgICBzZWxmLnNob3dJbWFnZSgpO1xuICAgIH1cblxuICAgIGlmIChvbGRXaWR0aCAhPT0gbmV3V2lkdGggfHwgb2xkSGVpZ2h0ICE9PSBuZXdIZWlnaHQpIHtcbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFuaW1hdGUoe1xuICAgICAgICB3aWR0aDogbmV3V2lkdGgsXG4gICAgICAgIGhlaWdodDogbmV3SGVpZ2h0XG4gICAgICB9LCB0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sICdzd2luZycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBwb3N0UmVzaXplKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zdFJlc2l6ZSgpO1xuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IHRoZSBpbWFnZSBhbmQgaXRzIGRldGFpbHMgYW5kIGJlZ2luIHByZWxvYWQgbmVpZ2hib3JpbmcgaW1hZ2VzLlxuICBMaWdodGJveC5wcm90b3R5cGUuc2hvd0ltYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlcicpLnN0b3AodHJ1ZSkuaGlkZSgpO1xuICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpLmZhZGVJbih0aGlzLm9wdGlvbnMuaW1hZ2VGYWRlRHVyYXRpb24pO1xuXG4gICAgdGhpcy51cGRhdGVOYXYoKTtcbiAgICB0aGlzLnVwZGF0ZURldGFpbHMoKTtcbiAgICB0aGlzLnByZWxvYWROZWlnaGJvcmluZ0ltYWdlcygpO1xuICAgIHRoaXMuZW5hYmxlS2V5Ym9hcmROYXYoKTtcbiAgfTtcblxuICAvLyBEaXNwbGF5IHByZXZpb3VzIGFuZCBuZXh0IG5hdmlnYXRpb24gaWYgYXBwcm9wcmlhdGUuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS51cGRhdGVOYXYgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdG91Y2ggZXZlbnRzLiBJZiBzbywgd2UgdGFrZSB0aGUgY29uc2VydmF0aXZlIGFwcHJvYWNoXG4gICAgLy8gYW5kIGFzc3VtZSB0aGF0IG1vdXNlIGhvdmVyIGV2ZW50cyBhcmUgbm90IHN1cHBvcnRlZCBhbmQgYWx3YXlzIHNob3cgcHJldi9uZXh0IG5hdmlnYXRpb25cbiAgICAvLyBhcnJvd3MgaW4gaW1hZ2Ugc2V0cy5cbiAgICB2YXIgYWx3YXlzU2hvd05hdiA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBkb2N1bWVudC5jcmVhdGVFdmVudCgnVG91Y2hFdmVudCcpO1xuICAgICAgYWx3YXlzU2hvd05hdiA9ICh0aGlzLm9wdGlvbnMuYWx3YXlzU2hvd05hdk9uVG91Y2hEZXZpY2VzKSA/IHRydWUgOiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5hdicpLnNob3coKTtcblxuICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCkge1xuICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2LCAubGItbmV4dCcpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYsIC5sYi1uZXh0Jykuc2hvdygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPiAwKSB7XG4gICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5zaG93KCk7XG4gICAgICAgICAgaWYgKGFsd2F5c1Nob3dOYXYpIHtcbiAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2JykuY3NzKCdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPCB0aGlzLmFsYnVtLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLnNob3coKTtcbiAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5leHQnKS5jc3MoJ29wYWNpdHknLCAnMScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBEaXNwbGF5IGNhcHRpb24sIGltYWdlIG51bWJlciwgYW5kIGNsb3NpbmcgYnV0dG9uLlxuICBMaWdodGJveC5wcm90b3R5cGUudXBkYXRlRGV0YWlscyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIEVuYWJsZSBhbmNob3IgY2xpY2tzIGluIHRoZSBpbmplY3RlZCBjYXB0aW9uIGh0bWwuXG4gICAgLy8gVGhhbmtzIE5hdGUgV3JpZ2h0IGZvciB0aGUgZml4LiBAaHR0cHM6Ly9naXRodWIuY29tL05hdGVXclxuICAgIGlmICh0eXBlb2YgdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgIHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUgIT09ICcnKSB7XG4gICAgICB2YXIgJGNhcHRpb24gPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY2FwdGlvbicpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5zYW5pdGl6ZVRpdGxlKSB7XG4gICAgICAgICRjYXB0aW9uLnRleHQodGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkY2FwdGlvbi5odG1sKHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0udGl0bGUpO1xuICAgICAgfVxuICAgICAgJGNhcHRpb24uZmFkZUluKCdmYXN0JylcbiAgICAgICAgLmZpbmQoJ2EnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmICgkKHRoaXMpLmF0dHIoJ3RhcmdldCcpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKCQodGhpcykuYXR0cignaHJlZicpLCAkKHRoaXMpLmF0dHIoJ3RhcmdldCcpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gMSAmJiB0aGlzLm9wdGlvbnMuc2hvd0ltYWdlTnVtYmVyTGFiZWwpIHtcbiAgICAgIHZhciBsYWJlbFRleHQgPSB0aGlzLmltYWdlQ291bnRMYWJlbCh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSwgdGhpcy5hbGJ1bS5sZW5ndGgpO1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLnRleHQobGFiZWxUZXh0KS5mYWRlSW4oJ2Zhc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLmhpZGUoKTtcbiAgICB9XG5cbiAgICB0aGlzLiRvdXRlckNvbnRhaW5lci5yZW1vdmVDbGFzcygnYW5pbWF0aW5nJyk7XG5cbiAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItZGF0YUNvbnRhaW5lcicpLmZhZGVJbih0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHNlbGYuc2l6ZU92ZXJsYXkoKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBQcmVsb2FkIHByZXZpb3VzIGFuZCBuZXh0IGltYWdlcyBpbiBzZXQuXG4gIExpZ2h0Ym94LnByb3RvdHlwZS5wcmVsb2FkTmVpZ2hib3JpbmdJbWFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5hbGJ1bS5sZW5ndGggPiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgMSkge1xuICAgICAgdmFyIHByZWxvYWROZXh0ID0gbmV3IEltYWdlKCk7XG4gICAgICBwcmVsb2FkTmV4dC5zcmMgPSB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXggKyAxXS5saW5rO1xuICAgIH1cbiAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA+IDApIHtcbiAgICAgIHZhciBwcmVsb2FkUHJldiA9IG5ldyBJbWFnZSgpO1xuICAgICAgcHJlbG9hZFByZXYuc3JjID0gdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4IC0gMV0ubGluaztcbiAgICB9XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmVuYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgJChkb2N1bWVudCkub24oJ2tleXVwLmtleWJvYXJkJywgJC5wcm94eSh0aGlzLmtleWJvYXJkQWN0aW9uLCB0aGlzKSk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmRpc2FibGVLZXlib2FyZE5hdiA9IGZ1bmN0aW9uKCkge1xuICAgICQoZG9jdW1lbnQpLm9mZignLmtleWJvYXJkJyk7XG4gIH07XG5cbiAgTGlnaHRib3gucHJvdG90eXBlLmtleWJvYXJkQWN0aW9uID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2YXIgS0VZQ09ERV9FU0MgICAgICAgID0gMjc7XG4gICAgdmFyIEtFWUNPREVfTEVGVEFSUk9XICA9IDM3O1xuICAgIHZhciBLRVlDT0RFX1JJR0hUQVJST1cgPSAzOTtcblxuICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICB2YXIga2V5ICAgICA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5Y29kZSkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoa2V5Y29kZSA9PT0gS0VZQ09ERV9FU0MgfHwga2V5Lm1hdGNoKC94fG98Yy8pKSB7XG4gICAgICB0aGlzLmVuZCgpO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09PSAncCcgfHwga2V5Y29kZSA9PT0gS0VZQ09ERV9MRUZUQVJST1cpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICE9PSAwKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSh0aGlzLmFsYnVtLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnbicgfHwga2V5Y29kZSA9PT0gS0VZQ09ERV9SSUdIVEFSUk9XKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAhPT0gdGhpcy5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhpcy5jaGFuZ2VJbWFnZSgwKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQ2xvc2luZyB0aW1lLiA6LShcbiAgTGlnaHRib3gucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZGlzYWJsZUtleWJvYXJkTmF2KCk7XG4gICAgJCh3aW5kb3cpLm9mZigncmVzaXplJywgdGhpcy5zaXplT3ZlcmxheSk7XG4gICAgdGhpcy4kbGlnaHRib3guZmFkZU91dCh0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcbiAgICB0aGlzLiRvdmVybGF5LmZhZGVPdXQodGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG4gICAgJCgnc2VsZWN0LCBvYmplY3QsIGVtYmVkJykuY3NzKHtcbiAgICAgIHZpc2liaWxpdHk6ICd2aXNpYmxlJ1xuICAgIH0pO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZVNjcm9sbGluZykge1xuICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdsYi1kaXNhYmxlLXNjcm9sbGluZycpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gbmV3IExpZ2h0Ym94KCk7XG59KSk7XG4iXX0=
